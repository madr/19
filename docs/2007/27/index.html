<!doctype html><html lang=sv><head><meta charset=UTF-8><title>Leker med DOMDocument | Anders Ytterstr√∂ms hemsida</title><meta name=viewport content="width=device-width"><link rel=stylesheet title="madr.se stilmall" href=/madrse.css><link href=/prenumerera.xml type=application/atom+xml rel=alternate title=madr.se><link rel=canonical href=https://madr.se//2007/27/ ><meta property=og:title content="Leker med DOMDocument"><meta property=og:type content=article><meta property=og:url content=https://madr.se//2007/27/ ><meta property=og:image content=https://sv.gravatar.com/avatar/981e98db0f85baaa05dddd1ee46a3276><meta property=og:site_name content="Anders Ytterstr√∂ms hemsida"></head><body><a href=#content class=skiplink>Hoppa till inneh√•ll</a><header><a href=/ rel=home>madr.se</a><nav><a href=/bl/ >ü§ò Br√ºtal Legend</a> <a href=/evenemang/ >üìÖ Evenemang</a> <a href=/om/ >ü§∑‚Äç‚ôÇÔ∏è Om</a> <a href=http://broken-close-swan.gigalixirapp.com/live>üé≤ RISK</a> <a href=/prenumerera.xml rel=alternate title="Prenumerera via Atom">üì£</a></nav></header><main id=content><p class=alert--archived><i>Detta √§r ett arkiverat inl√§gg, som importerats hit f√∂r referens. Det kan se konstigt ut och inneh√•lla utdaterad information eller inaktuella √•sikter.</i></p><article><h1>Leker med DOMDocument</h1><footer><time>2007-05-27</time> av <a rel=author href=/om><img src=https://sv.gravatar.com/avatar/981e98db0f85baaa05dddd1ee46a3276 alt=portr√§tt> Anders Ytterstr√∂m</a></footer><p>M√•nga utav de klasser som utg√∂r Madr webbapplikation skall skrivas om inom en snar framtid. En av de delar jag aldrig varit riktigt n√∂jd med √§r hur mina kontrollerare behandlar datatransport fr√•n modellagret till vylagret.</p><p>Min mallmotor (template engine) √§r transformsbaserad, och bygger p√• XSL via klassen XSLTPRocessor. D√• XSLTPRocessor-objektet tar emot ett DOM-dokument som argument f√∂r att generera HTML, m√•ste modellagrets datasamling f√∂rvandlas till ett s√•dant. Min nuvarande l√∂sning p√• detta √§r verkligen f√∂rskr√§cklig:</p><ol><li>Beg√§r en n√§stlad vektor fr√•n modellen till kontrolleraren.</li><li>n√§stla vektorn √§nnu mer f√∂r att all data skall f√• plats.</li><li>Initiera vy-objektet med vektorn som argument.</li><li>Importera vektorn till ett DOM-dokument via DomBuilder::import($data). alla nummernycklar byts ut mot "rs".\</li><li>Exportera och importera DOM-dokumentet igen f√∂r att leka litet med HTML_entities_decode() och HTML_entities() f√∂r att allt skall se bra ut.</li><li>Transformera och skriv ut HTML.\</li></ol><p>En ful och mycket otrevlig l√∂sning att arbeta med. DOM-dokumentet som generas av ovanst√•ende algoritm √§r helt befriade fr√•n logisk och semantisk struktur, vilket g√∂r det mer komplicerat √§n √∂nskv√§rt att skapa XSL-mallar till el√§ndet.</p><p>Anledningen till att det blivit s√•h√§r √§r att jag vid implementations tidpunkt inte hade en aning om hur att bem√§stra DOM. S√• √§r inte fallet idag. Jag skall d√§rf√∂r √•terimplementera hela l√∂sningen med ett globalt DOM-dokument. Datamodellen skall inte √•ters√§nda vektorer, utan en elementnod med barnnoder som importeras direkt till det globala DOM-dokumentet. N√§r mallmotorn sedan skall transformera beh√∂vs ingen l√∂jlig importering, plus att DOM-dokumentets struktur √§r intakt och semantisk.</p><p>Jag satt idag och lekte med detta, d√• jag provade blanda tv√• importtekniker: Vektor till DOM, och extern XML-fil till DOM. Detta finns uppe i mitt labarkiv:\</p><ul><li><a href=http://src.madr.se/php/dom/dom.php>Import till DOMDocument</a></li><li><a href=http://src.madr.se/php/dom/dom.phps>K√§llkod</a></li></ul></article></main><footer><p><a href=https://creativecommons.org/licenses/by-sa/4.0/ lang=en>CC BY-SA 4.0</a> av Anders Ytterstr√∂m sedan dec 2006. <a rel=alternate href=/prenumerera.xml>Prenumerera</a>.</p></footer></body></html>
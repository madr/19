<!doctype html><html lang=sv><head><meta charset=UTF-8><title>Hantera DOM-noder med ArrayAccess och Iterator | Anders Ytterstr√∂ms hemsida</title><meta name=viewport content="width=device-width"><link rel=stylesheet title="madr.se stilmall" href=/madrse.css><link href=/prenumerera.xml type=application/atom+xml rel=alternate title=madr.se><link rel=canonical href=https://madr.se//2007/59/ ><meta property=og:title content="Hantera DOM-noder med ArrayAccess och Iterator"><meta property=og:type content=article><meta property=og:url content=https://madr.se//2007/59/ ><meta property=og:image content=https://sv.gravatar.com/avatar/981e98db0f85baaa05dddd1ee46a3276><meta property=og:site_name content="Anders Ytterstr√∂ms hemsida"></head><body><a href=#content class=skiplink>Hoppa till inneh√•ll</a><header><a href=/ rel=home>madr.se</a><nav><a href=/bl/ >ü§ò Br√ºtal Legend</a> <a href=/evenemang/ >üìÖ Evenemang</a> <a href=/om/ >ü§∑‚Äç‚ôÇÔ∏è Om</a> <a href=http://broken-close-swan.gigalixirapp.com/live>üé≤ RISK</a> <a href=/prenumerera.xml rel=alternate title="Prenumerera via Atom">üì£</a></nav></header><main id=content><p class=alert--archived><i>Detta √§r ett arkiverat inl√§gg, som importerats hit f√∂r referens. Det kan se konstigt ut och inneh√•lla utdaterad information eller inaktuella √•sikter.</i></p><article><h1>Hantera DOM-noder med ArrayAccess och Iterator</h1><footer><time>2007-12-09</time> av <a rel=author href=/om><img src=https://sv.gravatar.com/avatar/981e98db0f85baaa05dddd1ee46a3276 alt=portr√§tt> Anders Ytterstr√∂m</a></footer><p>Man talar ofta om XML och dess fantastik, dess underbara potential att cacha databaser och annat. Sj√§lv anv√§nder jag det f√∂r enklare data-arrayer som √§r f√∂r simpla och laddas in f√∂r s√§llan f√∂r att tj√§na p√• att ligga i en databas.</p><p>Att arbeta med DOM i PHP5 har dock sina baksidor: det √§r litet klurigt att arbeta med vyer om man som jag har en f√∂rk√§rlek f√∂r <code>DOMDocument</code>. Problemet bottnar i att det finns tre typer av noder, varav tv√• - attributnoder och textnoder - inneh√•ller data. Dessa tv√• har dessutom helt annorlunda s√§tt att n√•s via DOM API.</p><p>V√•r exempelfil (testcase.xml)</p><ol><li><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf8&quot;?&gt;</code></li><li><code>&lt;madr&gt;</code></li><li><code>&lt;foo name=&quot;anders&quot; role=&quot;gui developer&quot;&gt;</code></li><li><code>&lt;cons name=&quot;yo&quot;&gt;pizza&lt;/cons&gt;</code></li><li><code>&lt;cons name=&quot;yo&quot;&gt;kebab&lt;/cons&gt;</code></li><li><code>&lt;cons name=&quot;yo&quot;&gt;computers&lt;/cons&gt;</code></li><li><code>&lt;goods&gt;hates vegetables.&lt;/goods&gt;</code></li><li><code>&lt;/foo&gt;</code></li><li><code>&lt;foo name=&quot;mimmie&quot; role=&quot;author&quot;&gt;</code></li><li><code>&lt;cons name=&quot;yo&quot;&gt;music&lt;/cons&gt;</code></li><li><code>&lt;cons name=&quot;yo&quot;&gt;cars&lt;/cons&gt;</code></li><li><code>&lt;goods&gt;silent.&lt;/goods&gt;</code></li><li><code>&lt;/foo&gt;</code></li><li><code>&lt;/madr&gt;</code></li></ol><p>Jag t√§nkte mig f√∂rst en serialiseringsl√∂sning, d√§r jag f√∂rst laddade in dokumentet, k√∂rde en get-operation och f√∂rvandlade hela resultatobjektet (<code>DOMNodeList</code> eller <code>DOMElement</code>) till en array. Detta har jag dock redan gjort f√∂rut, s√• jag tog mig ann en litet annorlunda l√∂sningsmetod; jag skrev en klass som agerar som abstrakt resultatshanterare och som implementerar <a href=http://www.php.net/~helly/php/ext/spl/interfaceArrayAccess.html title="Manualsida f√∂r ArrayAccess interface">ArrayAccess</a>. <code>ArrayAccess</code> ger mig m√∂jligheten att kunna skapa getters med arraygr√§nssnitt.</p><p>I nedanst√•ende exempel anv√§nder jag <code>ResultSet</code> f√∂r att skriva ut v√§rden p√• <code>name</code>, <code>role</code> och f√∂rsta <code>cons</code> f√∂r varje <code>foo</code> i ovanst√•ende datatr√§d. D√§refter g√∂r jag samma sak med de implementerade DOM-funktionerna i PHP5.</p><ol><li><code>&lt;?php</code></li><li><code>$doc = new DOMDocument(&#39;1.0&#39;,&#39;utf8&#39;);</code></li><li><code>$doc-&gt;load(realpath(&#39;testcase.xml&#39;));</code></li><li><code>$peoples = $doc-&gt;getElementsByTagName(&#39;foo&#39;);</code></li><li><code>// with ResultSet class</code></li><li><code>$rs = new ResultSet( $peoples );</code></li><li><code>foreach($rs as $foo) {</code></li><li><code>$name = $foo[&#39;name&#39;];</code></li><li><code>$role = $foo[&#39;role&#39;];</code></li><li><code>$firstCons = $foo[&#39;cons&#39;][0][&#39;body&#39;];</code></li><li><code>printf(&#39;&lt;p&gt;&lt;strong&gt;%s&lt;/strong&gt;, &lt;em&gt;%s&lt;/em&gt;: %s&gt;/p&gt;&#39;,</code></li><li><code>$name, $role, $firstCons);</code></li><li><code>}</code></li><li><code>// old fashion way</code></li><li><code>foreach ($peoples as $foo) {</code></li><li><code>$name = $foo-&gt;getAttribute(&#39;name&#39;);</code></li><li><code>$role = $foo-&gt;getAttribute(&#39;role&#39;);</code></li><li><code>$firstCons = $foo-&gt;getElementsByTagName(&#39;cons&#39;)-&gt;item(0)-&gt;lastChild-&gt;nodeValue;</code></li><li><code>printf(&#39;&lt;p&gt;&lt;strong&gt;%s&lt;/strong&gt;, &lt;em&gt;%s&lt;/em&gt;: %s&gt;/p&gt;&#39;,</code></li><li><code>$name, $role, $firstCons);</code></li><li><code>}</code></li></ol><p>Resultatet blir f√∂ljande utskrift:</p><p><strong>anders</strong>, <em>gui developer</em>: pizza</p><p><strong>mimmie</strong>, <em>author</em>: music</p><p><strong>anders</strong>, <em>gui developer</em>: pizza</p><p><strong>mimmie</strong>, <em>author</em>: music</p><p>Jag f√∂redrar det.</p><p>Enbart sett till gr√§nssnittet √§r det ur min synvinkel en klar f√∂rb√§ttring, d√• det √§r ett mer konsekvent genom att inte g√∂ra skillnad p√• attribut och textnoder.</p><p>Men det √§r inte allt: <code>ResultSet</code> √§r konstruerat f√∂r att prova <em>alla</em> m√∂jliga utslag; gettern kikar allts√• igenom attribut och barnelement, och g√∂r utifr√•n detta en kvalificerad gissning p√• vad som efterfr√•gas.</p><p>Detta g√∂r att jag t.ex skulle kunna flytta ner <code>role</code> som ett barnelement, allts√• <code>&lt;role&gt;gui developer&lt;/role&gt;</code> i,st√§llet f√∂r att ha det som ett attribut till <code>foo</code>. Denna flexibilitet har inte traditionella l√∂sningar, d√• jag specifikt m√•ste be om vad jag vill ha.</p><p>Ej perfekt; feedback uppskattas!</p><p>Klassen √§r ett nyck som jag spontant h√•rdkodade utan minsta planering tidigt imorse (ig√•r natt), och det finns givetvis behov av f√∂rb√§ttringar. Det viktigaste √§r att ingen hantering f√∂r dubletter - att ett barnelement och ett attribut skulle ha samma namn - existerar i urvalet.</p><p>Klassen nyttjar dessutom inte setters; skrivskydd r√•der d√§rf√∂r i nuvarande version.</p><ul><li><a href=http://src.madr.se/php/ResultSet.php>Testa scriptet sj√§lv</a></li><li><a href=http://src.madr.se/php/ResultSet.phps>Se k√§llkod</a></li><li><a href=http://src.madr.se/php/testcase.xml>Exempelfilen testcase.xml</a></li></ul><p><strong>Uppdatering:</strong> Punkter strukna. Jag har nu suttit och lekt vidare med ett annat interface, <code>Iterator</code>. Denna tillf√∂r det sista jag ville ha fr√•n klassen. Det √§r nu fullt m√∂jligt att sl√§nga in objekten direkt i <code>foreach</code>-block for att skapa en iteration.</p><p>Klassen √§r nu en del av MWA, och anv√§nds redan p√• en annan sajt (just det, MWA √§r p√• v√§g utanf√∂r sina vanliga gr√§nser).</p></article></main><footer><p><a href=https://creativecommons.org/licenses/by-sa/4.0/ lang=en>CC BY-SA 4.0</a> av Anders Ytterstr√∂m sedan dec 2006. <a rel=alternate href=/prenumerera.xml>Prenumerera</a>.</p></footer></body></html>
<!doctype html><html lang=sv><head><meta charset=UTF-8><title>Fullst칛ndigt on칬digt men skojigt - f칬rb칛ttrad prestanda | Skrivna ord av Anders Ytterstr칬m.</title><meta name=viewport content="width=device-width"><link rel=stylesheet title="madr.se stilmall" href=../../madrse.css><link href=../../prenumerera.xml type=application/atom+xml rel=alternate title=madr.se><link rel=stylesheet title="madr.se stilmall" href=../madrse.css><link href=../prenumerera.xml type=application/atom+xml rel=alternate title=madr.se><link rel=canonical href=https://madr.se//2012/yslow-pagespeed/ ><meta property=og:title content="Fullst칛ndigt on칬digt men skojigt - f칬rb칛ttrad prestanda"><meta property=og:type content=article><meta property=og:url content=https://madr.se//2012/yslow-pagespeed/ ><meta property=og:image content=https://madr.se/mugshot.jpg><meta property=og:site_name content="Skrivna ord av Anders Ytterstr칬m."></head><body><a href=#content class=skiplink>Hoppa till inneh친ll</a><header><a href=../../ rel=home><img class=portrait src=../../mugshot.jpg alt="Anders, september 2018."></a><p class=presentation>Anders 칛r en webbutvecklare och h친rdrockare som gillar br칛dspel, kaffe och 칬l. <a href=../../om/ rel=author>Om Anders Ytterstr칬m</a></p><nav><h2 class=visuallyhidden>Meny</h2><a class=nav__item href=../../bl/ >游뱆 Br칲tal Legend</a> <a class=nav__item href=../../evenemang/ >游늰 Evenemang</a></nav></header><main id=content><article><h1>Fullst칛ndigt on칬digt men skojigt - f칬rb칛ttrad prestanda</h1><p>Django 칛r ett ramverk som jag verkligen vill satsa p친. En utmaning v칛rdig den b칛ste 칛r att skapa f칬ruts칛ttningar f칬r riktigt, riktigt bra prestanda f칬r en sajt.</p><p>Nu talar jag inte om svarstider och annat, utan snarare om <a href=http://www.stevesouders.com/blog/2012/02/10/the-performance-golden-rule/ >Steve Souders golden rule</a>:</p><blockquote><p>80-90% of the end-user response time is spent on the frontend. Start there.</p></blockquote><p>N칛r <a href=/b/hur-webbplatsen-byggdes>nya madr.se gick live</a> hade jag redan plockat f칬ljande l친gt h칛ngande frukter:</p><ul><li>CSS och JavaScript ligger p친 en bucket p친 Amazon S3, dels f칬r att vara cookie-free men ocks친 f칬r att spara CPU till Django och Python.</li><li>Minifiering av CSS och JavaScript. H칛r anv칛nder jag sedan m친nga 친r tillbaka <a href=http://developer.yahoo.com/yui/compressor/ >YUI compressor</a> d친 den 칛r tillr칛ckligt bra samt mycket portabel.</li><li>Far-future Expires, satt till 666 dygn, f칬r CSS och JavaScript. Detta s칛tts vid uppladdningen till Amazon S3 (se kod l칛ngre ner).</li></ul><p>Nu har jag allts친 gjort litet mer tweaks.</p><p>##Ikoner 칛r inte l칛ngre bilder</p><p>Ikoner har historiskt sett hanterats via CSS Sprites n칛r man talar om optimering av webbprestanda, men p친 sistone har en trend d칛r man ist칛llet bakar in ikoner som en font uppst친tt. Mer om detta finns t ex p친 <a href=http://css-tricks.com/examples/IconFont/ >Icon Fonts are Awesome</a>.</p><p>Jag s친g chansen att testa <a href=http://keyamoon.com/icomoon/app/ >Icomoon</a> d칛r jag skapade en anpassad font, en delm칛ngd best친ende av 5-6 ikoner anpassad f칬r 16px storlek. Verktyget 칛r <strong>helt fantastiskt</strong> och b칬r ses av alla!</p><h2>CSS, JavaScript och fonter 칛r zippade</h2><p>F칬r att f칬rlora ytterligare litet vikt detta anpassade jag det python-script jag anv칛nder f칬r att rekursivt ladda upp en katalog till Amazon S3. Scriptet zippar nu alla filer som syns p친 utsidan (d칛rmed 칛r Django-admins filer undantagna). Ser ut s친h칛r:</p><pre><code>future = 60*60*24*666
future_date = datetime.now() + timedelta(seconds=future)
future_date = future_date.strftime(&quot;%a, %d %b %Y %H:%M:%S GMT&quot;)

def upload_file(src):
    print &quot;- uploading %s&quot; % src
    f = open(src)
    n = src.replace(&quot;./&quot;, &quot;&quot;)
    h = { &quot;Cache-Control&quot;: &quot;max-age=%d&quot; % future, 
             &quot;Expires&quot;: future_date }
    
    if &quot;zipped&quot; in n or n == &quot;js/iosorientationchange.min.js&quot;:
        h[&quot;Content-Encoding&quot;] = &quot;gzip&quot;

    if n.find(&quot;admin&quot;) != -1:
        s3.put(n, f.read()) 
    else:
        s3.put(n, f.read(), headers=h)
</code></pre><h2>HTML-sidor 칛r minifierade och zippade</h2><p>츿ven HTML-dokumenten 칛r zippade och slimmande fr친n on칬diga white-spaces (enbart i produktion, tack och lov). Detta 칛r t칛mligen trivialt att 친stadkomma tack vare <a href=http://pypi.python.org/pypi/django-htmlmin>django-htmlmin</a>. Bara att installera:</p><pre><code>pip install django-htmlmin
</code></pre><p>och d칛refter l칛gga till tv친 rader i <code>settings.py</code>.</p><pre><code>MIDDLEWARE_CLASSES = (
    'django.middleware.gzip.GZipMiddleware',
    'htmlmin.middleware.HtmlMinifyMiddleware',
    # ...
)
</code></pre><h2>Resultatet: riktigt bra</h2><p>Detta gav mig po칛ngen <em>95 av 100</em> enligt <a href=http://developer.yahoo.com/yslow/ >YSlow</a> och <strong>92 av 100</strong> enligt <a href=https://developers.google.com/speed/pagespeed/insights>Google Page Speed</a>. Det 칛r ungef칛r s친 bra som man kan f친 genom att plocka l친gt h칛ngande frukter i optimering av webbprestanda.</p><p>Jag drar 칛ven slutsatsen att Django i kombination med Amazon S3 ger <strong>ypperliga</strong> f칬ruts칛ttningar f칬r bra webbprestanda.</p></article></main><aside><h2 class=h--aside>Senaste inl칛ggen</h2><ul class=recents><li class=recents__item><a href=../../2019/meta>Tuffa saker i senaste iterationen av madr.se</a></li><li class=recents__item><a href=../../2019/apps>Vad ber칛ttar mina program om mig?</a></li><li class=recents__item><a href=../../2019/ridderligheten>G칛rning i ridderlighetens namn</a></li><li class=recents__item><a href=../../2019/react-redux>Varf칬r och hur jag ska f칬rdjupa mig i React 2019</a></li><li class=recents__item><a href=../../2019/elixir>Varf칬r och hur jag ska fokusera p친 att l칛ra mig Elixir 2019</a></li></ul><h2 class=h--aside>Kommande evenemang</h2><ul class=upcoming><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Mayhem </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Fryshuset</span>, Stockholm </span><time datetime=2019-11-29T00:00:00Z class=upcoming__item__when itemprop=startDate><span>29</span> <span>nov</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Wardruna </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Annexet</span>, Stockholm </span><time datetime=2019-12-01T00:00:00Z class=upcoming__item__when itemprop=startDate><span>1</span> <span>dec</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Amon Amarth </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Annexet</span>, Stockholm </span><time datetime=2019-12-07T00:00:00Z class=upcoming__item__when itemprop=startDate><span>7</span> <span>dec</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Solstafir </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Fryshuset</span>, Stockholm </span><time datetime=2019-12-18T00:00:00Z class=upcoming__item__when itemprop=startDate><span>18</span> <span>dec</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Opeth </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Cirkus</span>, Stockholm </span><time datetime=2020-01-13T00:00:00Z class=upcoming__item__when itemprop=startDate><span>13</span> <span>jan</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Coraline </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Folkoperan</span>, Stockholm </span><time datetime=2020-02-05T00:00:00Z class=upcoming__item__when itemprop=startDate><span>5</span> <span>feb</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Gefle Metal Festival 4 </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Gasklockorna</span>, G칛vle </span><time datetime=2020-07-09T00:00:00Z class=upcoming__item__when itemprop=startDate><span>9</span> <span>jul</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Wacken Open Air 31 </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Wacken</span>, Tyskland </span><time datetime=2020-07-30T00:00:00Z class=upcoming__item__when itemprop=startDate><span>30</span> <span>jul</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Brutal Assault 25 </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Jarom캩콏</span>, Tjeckien </span><time datetime=2020-08-05T00:00:00Z class=upcoming__item__when itemprop=startDate><span>5</span> <span>aug</span></time></li></ul></aside><footer><p>Publicerades <time>2012-08-06</time>. <a href=https://creativecommons.org/licenses/by-sa/4.0/ lang=en>CC BY-SA 4.0</a> av Anders Ytterstr칬m sedan dec 2006. <a rel=alternate href=../../prenumerera.xml>Prenumerera</a>.</p></footer></body></html>
<!doctype html><html lang=sv><head><meta charset=UTF-8><title>Automatisera JSLint med Git hooks och Node.js | Anders Ytterstr√∂ms hemsida</title><meta name=viewport content="width=device-width"><link rel=stylesheet title="madr.se stilmall" href=/madrse.css><link href=/prenumerera.xml type=application/atom+xml rel=alternate title=madr.se><link rel=canonical href=https://madr.se//2012/jslint-git-hook/ ><meta property=og:title content="Automatisera JSLint med Git hooks och Node.js"><meta property=og:type content=article><meta property=og:url content=https://madr.se//2012/jslint-git-hook/ ><meta property=og:image content=https://sv.gravatar.com/avatar/981e98db0f85baaa05dddd1ee46a3276><meta property=og:site_name content="Anders Ytterstr√∂ms hemsida"></head><body><a href=#content class=skiplink>Hoppa till inneh√•ll</a><header><a href=/ rel=home>madr.se</a><nav><a href=/bl/ >ü§ò Br√ºtal Legend</a> <a href=/evenemang/ >üìÖ Evenemang</a> <a href=/om/ >ü§∑‚Äç‚ôÇÔ∏è Om</a> <a href=http://broken-close-swan.gigalixirapp.com/live>üé≤ RISK</a> <a href=/prenumerera.xml rel=alternate title="Prenumerera via Atom">üì£</a></nav></header><main id=content><article><h1>Automatisera JSLint med Git hooks och Node.js</h1><footer><time>2012-09-11</time> av <a rel=author href=/om><img src=https://sv.gravatar.com/avatar/981e98db0f85baaa05dddd1ee46a3276 alt=portr√§tt> Anders Ytterstr√∂m</a></footer><p>Jag har f√∂r vana att kvalitets√§kra JavaScript med <a href=http://jslint.com>JSLint</a>. Fram tills nyligen har jag gjort detta i och med att jag √§ven validerar min HTML och CSS, vilket h√§rlett till att jag automatiserat denna gemensamma aktivitet med <a href=https://github.com/madr/uidev-checklist>n√•gra √•teranv√§ndningsbara Ant-targets</a> som flyttat mellan mina projekt hemma och p√• jobbet.</p><p>Jag √§r r√§tt n√∂jd med att kunna g√∂ra dessa med en kommandorad i en terminal, men det finns alltid utrymme f√∂r f√∂rb√§ttringar. En brist med d√•varande setup √§r att JSLint inte k√∂rs f√∂rr√§n jag sj√§lv v√§ljer det, varvid n√•gra d√•liga rader kod faktiskt kan smyga ut i produktion om jag √§r slarvig med att k√∂ra ant.</p><p>D√• det mesta jag kodar versionshanteras med Git, finns det f√∂rb√§ttringar att skapa utifr√•n <a href=http://git-scm.com/book/en/Customizing-Git-Git-Hooks>Git hooks</a>. Med en <code>pre-commit</code> √§r det om√∂jligt att checka in d√•lig kod eftersom JSlint kan neka incheckningen.</p><p>Jag t√§nker inte f√∂rklara konceptet med git-hooks i detalj (l√§nken ovan g√∂r det b√§ttre √§n mig); jag ger ist√§llet iv√§g koden jag anv√§nder.</p><pre><code>#!/bin/sh
#
ROOT_DIR=$(git rev-parse --show-toplevel)
JSLINT=&quot;${ROOT_DIR}/node_modules/.bin/jslint&quot;
for file in $(git diff --cached --name-only | grep &#39;\.js$&#39;); do
  line=$(node $JSLINT $file | grep &#39;OK&#39;)
    if [ x&quot;$line&quot; = x ]; then
        node $JSLINT $file
        exit 1
    else
        echo &quot;jslint passed\n&quot;
    fi
done
exit 0</code></pre><p>V√§rt att notera i ovanst√•ende √§r att jag anv√§nder <a href=http://nodejs.org>Node.js</a> f√∂r att k√∂ra JSLint. Detta g√∂r jag f√∂r att den √§r √∂verl√§gset snabbast av alla implementationer av JSLint jag testat. Det g√•r s√•klart att k√∂ra Rhino eller n√•got annat ocks√•.</p><p>F√∂r att l√§gga till den h√§r git hooken i ett av dina projekt, g√∂r s√• h√§r:</p><h1 id=kopiera-texten-ovan->Kopiera texten ovan.</h1><h1 id=-ppna-filen-git-hooks-pre-commit-sample->√ñppna filen <code>.git/hooks/pre-commit.sample</code>.</h1><h1 id=klistra-in-texten-och-spara->Klistra in texten och spara.</h1><h1 id=d-p-om-filen-till-git-hooks-pre-commit->D√∂p om filen till <code>.git/hooks/pre-commit</code>.</h1><h1 id=g-r-den-nya-filen-k-rbar-chmod-x-git-hooks-pre-commit->G√∂r den nya filen k√∂rbar: <code>chmod +x .git/hooks/pre-commit</code>.</h1><p>F√∂r att installera Node.js:</p><ol><li>Installera enligt instruktionerna p√• <a href=http://nodejs.org>Nodejs.org</a>.<br>a. Macanv√§ndare kan installera via brew: <code>brew install node</code> b. Arch-anv√§ndare kan installera via pacman: <code>pacman -S node</code></li><li>i en terminal, g√• till projektets rot.</li><li>installera jslint: <code>npm install jslint</code></li></ol><p>Jag anv√§nder sj√§lv den h√§r hooken i alla mina projekt sedan en vecka tillbaka och det √§r genast litet tryggare att koda JavaScript n√§r det i princip √§r om√∂jligt att drifts√§tta ej kvalitetss√§krad kod.</p><p>D√• <a href=http://csslint.net>CSSLint</a> ocks√• ligger i Node.js skulle √§ven den bli en kandidat f√∂r version 2. Efter det kvarst√•r bara HTML-valideringen, vilket jag dock ser liten po√§ng med att validera s√• strikt: d√§r r√§cker troligen mina ant-targets tillsammans med ett CI-system.</p></article></main><footer><p><a href=https://creativecommons.org/licenses/by-sa/4.0/ lang=en>CC BY-SA 4.0</a> av Anders Ytterstr√∂m sedan dec 2006. <a rel=alternate href=/prenumerera.xml>Prenumerera</a>.</p></footer></body></html>
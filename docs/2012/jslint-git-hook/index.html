<!doctype html><html lang=sv><head><meta charset=UTF-8><title>Automatisera JSLint med Git hooks och Node.js | Skrivna ord av Anders Ytterström.</title><meta name=viewport content="width=device-width"><link rel=stylesheet title="madr.se stilmall" href=../../madrse.css><link href=../../prenumerera.xml type=application/atom+xml rel=alternate title=madr.se><link rel=stylesheet title="madr.se stilmall" href=../madrse.css><link href=../prenumerera.xml type=application/atom+xml rel=alternate title=madr.se><link rel=canonical href=https://madr.se//2012/jslint-git-hook/ ><meta property=og:title content="Automatisera JSLint med Git hooks och Node.js"><meta property=og:type content=article><meta property=og:url content=https://madr.se//2012/jslint-git-hook/ ><meta property=og:image content=https://madr.se/mugshot.jpg><meta property=og:site_name content="Skrivna ord av Anders Ytterström."></head><body><a href=#content class=skiplink>Hoppa till innehåll</a><header><a href=../../ rel=home><img class=portrait src=../../mugshot.jpg alt="Anders, september 2018."></a><p class=presentation>Anders är en webbutvecklare och hårdrockare som gillar brädspel, kaffe och öl. <a href=../../om/ rel=author>Om Anders Ytterström</a></p><nav><h2 class=visuallyhidden>Meny</h2><a class=nav__item href=../../bl/ >🤘 Brütal Legend</a> <a class=nav__item href=../../evenemang/ >📅 Evenemang</a> <a class=nav__item href=https://madr.github.io/mybgg/ >🎲 Brädspel</a> <a class=nav__item href=https://madr.github.io/urban-enigma/ >🦾 Styrketräning</a></nav></header><main id=content><article><h1>Automatisera JSLint med Git hooks och Node.js</h1><p>Jag har för vana att kvalitetsäkra JavaScript med <a href=http://jslint.com>JSLint</a>. Fram tills nyligen har jag gjort detta i och med att jag även validerar min HTML och CSS, vilket härlett till att jag automatiserat denna gemensamma aktivitet med <a href=https://github.com/madr/uidev-checklist>några återanvändningsbara Ant-targets</a> som flyttat mellan mina projekt hemma och på jobbet.</p><p>Jag är rätt nöjd med att kunna göra dessa med en kommandorad i en terminal, men det finns alltid utrymme för förbättringar. En brist med dåvarande setup är att JSLint inte körs förrän jag själv väljer det, varvid några dåliga rader kod faktiskt kan smyga ut i produktion om jag är slarvig med att köra ant.</p><p>Då det mesta jag kodar versionshanteras med Git, finns det förbättringar att skapa utifrån <a href=http://git-scm.com/book/en/Customizing-Git-Git-Hooks>Git hooks</a>. Med en <code>pre-commit</code> är det omöjligt att checka in dålig kod eftersom JSlint kan neka incheckningen.</p><p>Jag tänker inte förklara konceptet med git-hooks i detalj (länken ovan gör det bättre än mig); jag ger istället iväg koden jag använder.</p><pre><code>#!/bin/sh
#
ROOT_DIR=$(git rev-parse --show-toplevel)
JSLINT=&quot;${ROOT_DIR}/node_modules/.bin/jslint&quot;
for file in $(git diff --cached --name-only | grep '\.js$'); do
  line=$(node $JSLINT $file | grep 'OK')
    if [ x&quot;$line&quot; = x ]; then
        node $JSLINT $file
        exit 1
    else
        echo &quot;jslint passed\n&quot;
    fi
done
exit 0
</code></pre><p>Värt att notera i ovanstående är att jag använder <a href=http://nodejs.org>Node.js</a> för att köra JSLint. Detta gör jag för att den är överlägset snabbast av alla implementationer av JSLint jag testat. Det går såklart att köra Rhino eller något annat också.</p><p>För att lägga till den här git hooken i ett av dina projekt, gör så här:</p><h1>Kopiera texten ovan.</h1><h1>Öppna filen <code>.git/hooks/pre-commit.sample</code>.</h1><h1>Klistra in texten och spara.</h1><h1>Döp om filen till <code>.git/hooks/pre-commit</code>.</h1><h1>Gör den nya filen körbar: <code>chmod +x .git/hooks/pre-commit</code>.</h1><p>För att installera Node.js:</p><ol><li>Installera enligt instruktionerna på <a href=http://nodejs.org>Nodejs.org</a>.<br>a. Macanvändare kan installera via brew: <code>brew install node</code> b. Arch-användare kan installera via pacman: <code>pacman -S node</code></li><li>i en terminal, gå till projektets rot.</li><li>installera jslint: <code>npm install jslint</code></li></ol><p>Jag använder själv den här hooken i alla mina projekt sedan en vecka tillbaka och det är genast litet tryggare att koda JavaScript när det i princip är omöjligt att driftsätta ej kvalitetssäkrad kod.</p><p>Då <a href=http://csslint.net>CSSLint</a> också ligger i Node.js skulle även den bli en kandidat för version 2. Efter det kvarstår bara HTML-valideringen, vilket jag dock ser liten poäng med att validera så strikt: där räcker troligen mina ant-targets tillsammans med ett CI-system.</p></article></main><aside><h2 class=h--aside>Senaste inläggen</h2><ul class=recents><li class=recents__item><a href=../../2019/meta>Tuffa saker i senaste iterationen av madr.se</a></li><li class=recents__item><a href=../../2019/apps>Vad berättar mina program om mig?</a></li><li class=recents__item><a href=../../2019/ridderligheten>Gärning i ridderlighetens namn</a></li><li class=recents__item><a href=../../2019/react-redux>Varför och hur jag ska fördjupa mig i React 2019</a></li><li class=recents__item><a href=../../2019/elixir>Varför och hur jag ska fokusera på att lära mig Elixir 2019</a></li></ul><h2 class=h--aside>Kommande evenemang</h2><ul class=upcoming><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Mayhem </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Fryshuset</span>, Stockholm </span><time datetime=2019-11-29T00:00:00Z class=upcoming__item__when itemprop=startDate><span>29</span> <span>nov</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Wardruna </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Annexet</span>, Stockholm </span><time datetime=2019-12-01T00:00:00Z class=upcoming__item__when itemprop=startDate><span>1</span> <span>dec</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Amon Amarth </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Annexet</span>, Stockholm </span><time datetime=2019-12-07T00:00:00Z class=upcoming__item__when itemprop=startDate><span>7</span> <span>dec</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Solstafir </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Fryshuset</span>, Stockholm </span><time datetime=2019-12-18T00:00:00Z class=upcoming__item__when itemprop=startDate><span>18</span> <span>dec</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Opeth </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Cirkus</span>, Stockholm </span><time datetime=2020-01-13T00:00:00Z class=upcoming__item__when itemprop=startDate><span>13</span> <span>jan</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Coraline </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Folkoperan</span>, Stockholm </span><time datetime=2020-02-05T00:00:00Z class=upcoming__item__when itemprop=startDate><span>5</span> <span>feb</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Gefle Metal Festival 4 </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Gasklockorna</span>, Gävle </span><time datetime=2020-07-09T00:00:00Z class=upcoming__item__when itemprop=startDate><span>9</span> <span>jul</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Wacken Open Air 31 </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Wacken</span>, Tyskland </span><time datetime=2020-07-30T00:00:00Z class=upcoming__item__when itemprop=startDate><span>30</span> <span>jul</span></time></li><li class=upcoming__item itemscope itemtype=http://schema.org/Event><strong itemprop=name class=upcoming__item__what>Brutal Assault 25 </strong><span class=upcoming__item__where itemprop=location itemscope itemtype=http://schema.org/Place><span itemprop=name>Jaroměř</span>, Tjeckien </span><time datetime=2020-08-05T00:00:00Z class=upcoming__item__when itemprop=startDate><span>5</span> <span>aug</span></time></li></ul></aside><footer><p>Publicerades <time>2012-09-11</time>. <a href=https://creativecommons.org/licenses/by-sa/4.0/ lang=en>CC BY-SA 4.0</a> av Anders Ytterström sedan dec 2006. <a rel=alternate href=../../prenumerera.xml>Prenumerera</a>. Korrekt HTML5 och CSS 3.</p></footer></body></html>